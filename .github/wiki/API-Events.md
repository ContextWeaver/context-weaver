# Event Objects Reference

Complete reference for the structure and properties of content generated by Context Weaver.

## Generated Content Structure

All `generateContent()` methods return objects with this structure:

```javascript
{
  // Unique identifier
  id: "content_1704567890123_xyz789",

  // Human-readable title
  title: "Strategic Business Opportunity",

  // Main narrative content
  description: "A detailed narrative describing the scenario and current situation.",

  // Alternative property (same as description)
  narrative: "A detailed narrative describing the scenario and current situation.",

  // Interactive choices (if applicable)
  choices: [
    {
      text: "Choice description",
      effect: { stat: +10, otherStat: -5 },
      consequence: "choice_result"
    }
  ],

  // Metadata
  type: "BUSINESS_OPPORTUNITY",
  difficulty: "medium",
  theme: "business",
  tags: ["strategy", "investment", "growth"],

  // Generation context
  context: { /* Full context used */ },

  // Quality metrics
  qualityScore: 85,
  complexity: 7.2,

  // Optional: Debug information (if debug enabled)
  _debug: { /* Debug data */ }
}
```

## Core Properties

### `id: string`
Unique identifier for this content instance.

**Format:** `content_{timestamp}_{randomId}`

**Example:** `"content_1704567890123_xyz789"`

**Use cases:**
- Tracking content in databases
- Preventing duplicate content
- Referencing in chains/events

### `title: string`
Human-readable, concise title.

**Characteristics:**
- 3-8 words typically
- Context-aware (adapts to user profile)
- Engaging and descriptive

**Examples:**
- `"Strategic Business Opportunity"`
- `"Mysterious Ancient Artifact"`
- `"Critical System Malfunction"`

### `description: string` / `narrative: string`
Main content body with full narrative.

**Characteristics:**
- 50-200 words typically
- Rich, atmospheric descriptions
- Context-aware details
- Includes setting, characters, and situation

**Example:**
```
"You stand in the bustling marketplace of the ancient city of Eldoria.
Merchants hawk their wares while guards patrol the crowded streets.
A shady figure approaches you with a proposition that could change
everything..."
```

## Choices Array

### Structure
```javascript
choices: [
  {
    text: "Human-readable choice description",
    effect: {
      // Stat modifications (can be positive or negative)
      gold: +50,
      reputation: -10,
      experience: +25
    },
    consequence: "identifier_for_this_choice",
    requirements: { /* Optional requirements */ }
  }
]
```

### Choice Properties

#### `text: string`
Player-visible choice description.

**Guidelines:**
- Clear and concise (5-15 words)
- Action-oriented language
- Indicates likely outcome

#### `effect: object`
Stat modifications applied when chosen.

**Common stats:**
- `gold`, `health`, `mana` - Resources
- `experience`, `level` - Progression
- `reputation`, `influence` - Social
- `strength`, `intelligence` - Attributes

**Modifiers:**
- Positive: `+10` or `10`
- Negative: `-5`
- Multipliers: `{ gold: "*1.5" }` (50% bonus)

#### `consequence: string`
Identifier for choice result.

**Uses:**
- Chain advancement: `"hero_path"`, `"villain_path"`
- State changes: `"accepted_deal"`, `"rejected_offer"`
- Story branches: `"diplomatic_solution"`, `"combat_resolution"`

#### `requirements: object` (optional)
Prerequisites for choosing this option.

```javascript
requirements: {
  minLevel: 5,
  requiredStats: { strength: 10 },
  requiredItems: ["magic_sword"],
  forbiddenTags: ["cursed"]
}
```

## Metadata Properties

### `type: string`
Content category identifier.

**Common types:**
- `"BUSINESS_DEAL"`, `"MARKET_CRISIS"`
- `"DRAGON_ENCOUNTER"`, `"MAGIC_QUEST"`
- `"SYSTEM_FAILURE"`, `"DATA_BREACH"`

### `difficulty: string`
Content complexity level.

**Levels:**
- `"easy"` - Simple, forgiving content
- `"normal"` - Standard challenge
- `"medium"` - Moderate complexity
- `"hard"` - Challenging content
- `"legendary"` - Extreme difficulty

### `theme: string`
Content domain.

**Examples:**
- `"business"`, `"fantasy"`, `"sci-fi"`
- `"education"`, `"horror"`, `"historical"`

### `tags: string[]`
Content classification tags.

**Examples:**
```javascript
["strategy", "investment", "risk"]
["combat", "dragons", "adventure"]
["learning", "assessment", "STEM"]
```

## Quality Metrics

### `qualityScore: number` (0-100)
Overall content quality rating.

**Factors:**
- Coherence and readability
- Contextual appropriateness
- Choice balance and clarity
- Narrative engagement

### `complexity: number`
Content complexity score.

**Factors:**
- Vocabulary difficulty
- Sentence structure
- Concept density
- Required player knowledge

## Context Information

### `context: object`
Complete context used for generation.

```javascript
context: {
  // User context
  experience: 25,
  engagement: 500,
  profile: "executive",

  // Environmental context
  season: "winter",
  weather: "snow",
  location: "corporate_office",

  // Generation settings
  theme: "business",
  culture: "corporate",
  language: "en",

  // Applied rules and modifiers
  appliedRules: ["vip_bonus", "winter_setting"],
  activeModifiers: ["seasonal", "environmental"]
}
```

## Debug Information

### `_debug: object` (when debug enabled)
Detailed generation information.

```javascript
_debug: {
  generationTime: 45,  // milliseconds
  appliedRules: ["vip_bonus", "seasonal_theme"],
  failedRules: ["incompatible_modifier"],
  markovState: { /* Markov chain state */ },
  templateUsed: "business_negotiation",
  qualityBreakdown: {
    coherence: 85,
    engagement: 90,
    appropriateness: 80
  }
}
```

## Content Types

### Interactive Content
```javascript
{
  id: "content_123",
  title: "Boardroom Crisis",
  description: "The CEO has called an emergency meeting...",
  choices: [
    {
      text: "Present your solution immediately",
      effect: { influence: +15, risk: +20 },
      consequence: "bold_approach"
    },
    {
      text: "Gather more information first",
      effect: { information: +10, time: -5 },
      consequence: "cautious_approach"
    }
  ],
  type: "BUSINESS_CRISIS",
  difficulty: "hard"
}
```

### Narrative Content
```javascript
{
  id: "content_456",
  title: "The Ancient Library",
  description: "Dust motes dance in the sunlight filtering through stained glass...",
  choices: [],  // No choices - pure narrative
  type: "DESCRIPTIVE_SCENE",
  difficulty: "easy",
  tags: ["atmospheric", "exploration"]
}
```

### Template-Based Content
```javascript
{
  id: "content_789",
  title: "Dragon's Treasure Hoard",
  description: "Gold coins spill across the cavern floor...",
  choices: [
    {
      text: "Take the gold",
      effect: { gold: +1000 },
      consequence: "greedy_choice"
    }
  ],
  type: "TREASURE_DISCOVERY",
  difficulty: "medium",
  templateId: "dragon_hoard",
  templateVars: {
    treasureValue: 1000,
    dragonType: "ancient_red"
  }
}
```

## Validation

### Content Validation
```javascript
function validateContent(content) {
  // Required fields
  const required = ['id', 'title', 'description', 'type'];
  for (const field of required) {
    if (!content[field]) {
      throw new Error(`Missing required field: ${field}`);
    }
  }

  // ID format
  if (!content.id.startsWith('content_')) {
    throw new Error('Invalid content ID format');
  }

  // Choices validation
  if (content.choices) {
    content.choices.forEach((choice, index) => {
      if (!choice.text) {
        throw new Error(`Choice ${index} missing text`);
      }
      if (!choice.consequence) {
        throw new Error(`Choice ${index} missing consequence`);
      }
    });
  }

  // Quality checks
  if (content.qualityScore < 0 || content.qualityScore > 100) {
    throw new Error('Quality score out of range');
  }

  return true;
}

// Usage
try {
  validateContent(generatedContent);
  console.log('Content is valid');
} catch (error) {
  console.error('Content validation failed:', error.message);
}
```

## Serialization

### JSON Export
```javascript
const content = generator.generateContent();

// Serialize for storage/API
const jsonContent = JSON.stringify(content, null, 2);

// Deserialize
const loadedContent = JSON.parse(jsonContent);
```

### Database Storage
```javascript
// Store in database
await db.collection('generated_content').insertOne({
  ...content,
  createdAt: new Date(),
  userId: userId,
  sessionId: sessionId
});

// Retrieve with validation
const storedContent = await db.collection('generated_content')
  .findOne({ id: contentId });

if (storedContent) {
  validateContent(storedContent);
  return storedContent;
}
```

## Best Practices

### Content Processing
```javascript
function processGeneratedContent(content) {
  // Always validate
  validateContent(content);

  // Sanitize for display
  content.title = sanitizeHtml(content.title);
  content.description = sanitizeHtml(content.description);

  // Add UI metadata
  content.ui = {
    readTime: estimateReadTime(content.description),
    difficultyColor: getDifficultyColor(content.difficulty),
    themeIcon: getThemeIcon(content.theme)
  };

  return content;
}
```

### Error Handling
```javascript
function safeGenerateContent(generator, context) {
  try {
    const content = generator.generateContent(context);

    // Validate generated content
    validateContent(content);

    // Check quality thresholds
    if (content.qualityScore < 50) {
      console.warn('Low quality content generated:', content.id);
    }

    return content;
  } catch (error) {
    console.error('Content generation failed:', error);

    // Return fallback content
    return {
      id: 'fallback_content',
      title: 'Default Scenario',
      description: 'A basic interactive scenario.',
      choices: [{
        text: 'Continue',
        effect: {},
        consequence: 'continue'
      }],
      type: 'FALLBACK',
      difficulty: 'easy'
    };
  }
}
```

---

**Need to work with generated content?** Check the [API Methods Reference](API-Methods.md) for generation functions.
